        -:    0:Source:src/backend/tests/unit/test_router.c
        -:    0:Graph:build_backend_tests/test_router-test_router.gcno
        -:    0:Data:build_backend_tests/test_router-test_router.gcda
        -:    0:Runs:1
        -:    1:#include <stdarg.h>
        -:    2:#include <stddef.h>
        -:    3:#include <setjmp.h>
        -:    4:#include <cmocka.h>
        -:    5:#include <string.h>
        -:    6:#include <stdio.h>
        -:    7:#include <stdlib.h>
        -:    8:
        -:    9:// Header dosyalarını doğru path ile include et
        -:   10:#include "../api/router.h"
        -:   11:#include "../api/handlers/machine_handler.h"
        -:   12:#include "../api/handlers/inventory_handler.h"
        -:   13:#include "../api/handlers/auth_handler.h"
        -:   14:#include "../api/handlers/maintenance_handler.h"
        -:   15:#include "../api/handlers/report_handler.h"
        -:   16:#include "../api/handlers/fault_handler.h"
        -:   17:#include "../database/alert_service.h"
        -:   18:
        -:   19:/* ====================================================================
        -:   20: * MOCK FONKSİYONLAR VE GLOBAL DEĞİŞKENLER
        -:   21: * ==================================================================== */
        -:   22:
        -:   23:// Handler çağrılarını takip etmek için counter'lar
        -:   24:static int mock_machine_handler_called = 0;
        -:   25:static int mock_inventory_handler_called = 0;
        -:   26:static int mock_auth_handler_called = 0;
        -:   27:static int mock_maintenance_handler_called = 0;
        -:   28:static int mock_report_handler_called = 0;
        -:   29:static int mock_fault_handler_called = 0;
        -:   30:static int mock_alert_service_called = 0;
        -:   31:
        -:   32:// Handler'lara gönderilen request/response'ları kaydetmek için
        -:   33:static HttpRequest last_request;
        -:   34:static HttpResponse last_response;
        -:   35:
        -:   36:// Mock handler fonksiyonları
function handle_machine_request called 5 returned 100% blocks executed 100%
        5:   37:void handle_machine_request(HttpRequest *req, HttpResponse *res) {
        5:   38:    mock_machine_handler_called++;
        -:   39:    // Handler'ın request'i değiştirdiğini simüle et
        5:   40:    res->status_code = 200;
        5:   41:    strcpy(res->content_type, "application/json");
        5:   42:    strcpy(res->body, "{\"machines\":[]}");
        5:   43:}
        -:   44:
function handle_inventory_request called 4 returned 100% blocks executed 100%
        4:   45:void handle_inventory_request(HttpRequest *req, HttpResponse *res) {
        4:   46:    mock_inventory_handler_called++;
        4:   47:    res->status_code = 200;
        4:   48:    strcpy(res->content_type, "application/json");
        4:   49:    strcpy(res->body, "{\"inventory\":[]}");
        4:   50:}
        -:   51:
function handle_auth_request called 1 returned 100% blocks executed 100%
        1:   52:void handle_auth_request(HttpRequest *req, HttpResponse *res) {
        1:   53:    mock_auth_handler_called++;
        1:   54:    res->status_code = 200;
        1:   55:    strcpy(res->content_type, "application/json");
        1:   56:    strcpy(res->body, "{\"token\":\"mock_token\"}");
        1:   57:}
        -:   58:
function handle_maintenance_request called 3 returned 100% blocks executed 100%
        3:   59:void handle_maintenance_request(HttpRequest *req, HttpResponse *res) {
        3:   60:    mock_maintenance_handler_called++;
        3:   61:    res->status_code = 200;
        3:   62:    strcpy(res->content_type, "application/json");
        3:   63:    strcpy(res->body, "{\"maintenance\":[]}");
        3:   64:}
        -:   65:
function handle_report_request called 2 returned 100% blocks executed 100%
        2:   66:void handle_report_request(HttpRequest *req, HttpResponse *res) {
        2:   67:    mock_report_handler_called++;
        2:   68:    res->status_code = 200;
        2:   69:    strcpy(res->content_type, "application/json");
        2:   70:    strcpy(res->body, "{\"reports\":[]}");
        2:   71:}
        -:   72:
function handle_fault_request called 3 returned 100% blocks executed 100%
        3:   73:void handle_fault_request(HttpRequest *req, HttpResponse *res) {
        3:   74:    mock_fault_handler_called++;
        3:   75:    res->status_code = 200;
        3:   76:    strcpy(res->content_type, "application/json");
        3:   77:    strcpy(res->body, "{\"faults\":[]}");
        3:   78:}
        -:   79:
        -:   80:// Alert service mock
function alert_service_serialize_alerts called 1 returned 100% blocks executed 100%
        1:   81:char* alert_service_serialize_alerts(void) {
        1:   82:    mock_alert_service_called++;
        1:   83:    char *json = malloc(100);
        1:   84:    strcpy(json, "{\"alerts\":[{\"id\":1,\"message\":\"test\"}]}");
        1:   85:    return json;
        -:   86:}
        -:   87:
        -:   88:/* ====================================================================
        -:   89: * Test Setup/Teardown
        -:   90: * ==================================================================== */
        -:   91:
function reset_mocks called 22 returned 100% blocks executed 100%
       22:   92:static void reset_mocks(void) {
       22:   93:    mock_machine_handler_called = 0;
       22:   94:    mock_inventory_handler_called = 0;
       22:   95:    mock_auth_handler_called = 0;
       22:   96:    mock_maintenance_handler_called = 0;
       22:   97:    mock_report_handler_called = 0;
       22:   98:    mock_fault_handler_called = 0;
       22:   99:    mock_alert_service_called = 0;
        -:  100:    
       22:  101:    memset(&last_request, 0, sizeof(last_request));
       22:  102:    memset(&last_response, 0, sizeof(last_response));
       22:  103:}
        -:  104:
        -:  105:/* ====================================================================
        -:  106: * Test Cases - Tüm Route'lar
        -:  107: * ==================================================================== */
        -:  108:
function test_route_machines called 1 returned 100% blocks executed 100%
        1:  109:static void test_route_machines(void **state) {
        1:  110:    reset_mocks();
call    0 returned 1
        -:  111:    
        -:  112:    HttpRequest req;
        -:  113:    HttpResponse res;
        -:  114:    
        1:  115:    strcpy(req.path, "/api/machines");
        1:  116:    strcpy(req.method, "GET");
        -:  117:    
        1:  118:    handle_route(&req, &res);
call    0 returned 1
        -:  119:    
        -:  120:    // Handler çağrıldı mı?
        1:  121:    assert_int_equal(mock_machine_handler_called, 1);
call    0 returned 1
        1:  122:    assert_int_equal(mock_inventory_handler_called, 0);
call    0 returned 1
        1:  123:    assert_int_equal(mock_auth_handler_called, 0);
call    0 returned 1
        1:  124:    assert_int_equal(mock_maintenance_handler_called, 0);
call    0 returned 1
        1:  125:    assert_int_equal(mock_report_handler_called, 0);
call    0 returned 1
        1:  126:    assert_int_equal(mock_fault_handler_called, 0);
call    0 returned 1
        1:  127:    assert_int_equal(mock_alert_service_called, 0);
call    0 returned 1
        -:  128:    
        -:  129:    // Response doğru mu?
        1:  130:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  131:    assert_string_equal(res.content_type, "application/json");
call    0 returned 1
        1:  132:    assert_string_equal(res.body, "{\"machines\":[]}");
call    0 returned 1
        1:  133:}
        -:  134:
function test_route_machines_with_id called 1 returned 100% blocks executed 100%
        1:  135:static void test_route_machines_with_id(void **state) {
        1:  136:    reset_mocks();
call    0 returned 1
        -:  137:    
        -:  138:    HttpRequest req;
        -:  139:    HttpResponse res;
        -:  140:    
        1:  141:    strcpy(req.path, "/api/machines/123");
        1:  142:    strcpy(req.method, "GET");
        -:  143:    
        1:  144:    handle_route(&req, &res);
call    0 returned 1
        -:  145:    
        1:  146:    assert_int_equal(mock_machine_handler_called, 1);
call    0 returned 1
        1:  147:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  148:}
        -:  149:
function test_route_inventory called 1 returned 100% blocks executed 100%
        1:  150:static void test_route_inventory(void **state) {
        1:  151:    reset_mocks();
call    0 returned 1
        -:  152:    
        -:  153:    HttpRequest req;
        -:  154:    HttpResponse res;
        -:  155:    
        1:  156:    strcpy(req.path, "/api/inventory");
        1:  157:    strcpy(req.method, "GET");
        -:  158:    
        1:  159:    handle_route(&req, &res);
call    0 returned 1
        -:  160:    
        1:  161:    assert_int_equal(mock_inventory_handler_called, 1);
call    0 returned 1
        1:  162:    assert_int_equal(mock_machine_handler_called, 0);
call    0 returned 1
        1:  163:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  164:    assert_string_equal(res.body, "{\"inventory\":[]}");
call    0 returned 1
        1:  165:}
        -:  166:
function test_route_inventory_with_sku called 1 returned 100% blocks executed 100%
        1:  167:static void test_route_inventory_with_sku(void **state) {
        1:  168:    reset_mocks();
call    0 returned 1
        -:  169:    
        -:  170:    HttpRequest req;
        -:  171:    HttpResponse res;
        -:  172:    
        1:  173:    strcpy(req.path, "/api/inventory/MO-001");
        1:  174:    strcpy(req.method, "GET");
        -:  175:    
        1:  176:    handle_route(&req, &res);
call    0 returned 1
        -:  177:    
        1:  178:    assert_int_equal(mock_inventory_handler_called, 1);
call    0 returned 1
        1:  179:}
        -:  180:
function test_route_login called 1 returned 100% blocks executed 100%
        1:  181:static void test_route_login(void **state) {
        1:  182:    reset_mocks();
call    0 returned 1
        -:  183:    
        -:  184:    HttpRequest req;
        -:  185:    HttpResponse res;
        -:  186:    
        1:  187:    strcpy(req.path, "/api/login");
        1:  188:    strcpy(req.method, "POST");
        -:  189:    
        1:  190:    handle_route(&req, &res);
call    0 returned 1
        -:  191:    
        1:  192:    assert_int_equal(mock_auth_handler_called, 1);
call    0 returned 1
        1:  193:    assert_int_equal(mock_inventory_handler_called, 0);
call    0 returned 1
        1:  194:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  195:    assert_string_equal(res.body, "{\"token\":\"mock_token\"}");
call    0 returned 1
        1:  196:}
        -:  197:
function test_route_maintenance called 1 returned 100% blocks executed 100%
        1:  198:static void test_route_maintenance(void **state) {
        1:  199:    reset_mocks();
call    0 returned 1
        -:  200:    
        -:  201:    HttpRequest req;
        -:  202:    HttpResponse res;
        -:  203:    
        1:  204:    strcpy(req.path, "/api/maintenance");
        1:  205:    strcpy(req.method, "GET");
        -:  206:    
        1:  207:    handle_route(&req, &res);
call    0 returned 1
        -:  208:    
        1:  209:    assert_int_equal(mock_maintenance_handler_called, 1);
call    0 returned 1
        1:  210:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  211:    assert_string_equal(res.body, "{\"maintenance\":[]}");
call    0 returned 1
        1:  212:}
        -:  213:
function test_route_maintenance_with_id called 1 returned 100% blocks executed 100%
        1:  214:static void test_route_maintenance_with_id(void **state) {
        1:  215:    reset_mocks();
call    0 returned 1
        -:  216:    
        -:  217:    HttpRequest req;
        -:  218:    HttpResponse res;
        -:  219:    
        1:  220:    strcpy(req.path, "/api/maintenance/456");
        1:  221:    strcpy(req.method, "GET");
        -:  222:    
        1:  223:    handle_route(&req, &res);
call    0 returned 1
        -:  224:    
        1:  225:    assert_int_equal(mock_maintenance_handler_called, 1);
call    0 returned 1
        1:  226:}
        -:  227:
function test_route_reports called 1 returned 100% blocks executed 100%
        1:  228:static void test_route_reports(void **state) {
        1:  229:    reset_mocks();
call    0 returned 1
        -:  230:    
        -:  231:    HttpRequest req;
        -:  232:    HttpResponse res;
        -:  233:    
        1:  234:    strcpy(req.path, "/api/reports");
        1:  235:    strcpy(req.method, "GET");
        -:  236:    
        1:  237:    handle_route(&req, &res);
call    0 returned 1
        -:  238:    
        1:  239:    assert_int_equal(mock_report_handler_called, 1);
call    0 returned 1
        1:  240:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  241:    assert_string_equal(res.body, "{\"reports\":[]}");
call    0 returned 1
        1:  242:}
        -:  243:
function test_route_reports_with_type called 1 returned 100% blocks executed 100%
        1:  244:static void test_route_reports_with_type(void **state) {
        1:  245:    reset_mocks();
call    0 returned 1
        -:  246:    
        -:  247:    HttpRequest req;
        -:  248:    HttpResponse res;
        -:  249:    
        1:  250:    strcpy(req.path, "/api/reports/daily");
        1:  251:    strcpy(req.method, "GET");
        -:  252:    
        1:  253:    handle_route(&req, &res);
call    0 returned 1
        -:  254:    
        1:  255:    assert_int_equal(mock_report_handler_called, 1);
call    0 returned 1
        1:  256:}
        -:  257:
function test_route_faults called 1 returned 100% blocks executed 100%
        1:  258:static void test_route_faults(void **state) {
        1:  259:    reset_mocks();
call    0 returned 1
        -:  260:    
        -:  261:    HttpRequest req;
        -:  262:    HttpResponse res;
        -:  263:    
        1:  264:    strcpy(req.path, "/api/faults");
        1:  265:    strcpy(req.method, "GET");
        -:  266:    
        1:  267:    handle_route(&req, &res);
call    0 returned 1
        -:  268:    
        1:  269:    assert_int_equal(mock_fault_handler_called, 1);
call    0 returned 1
        1:  270:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  271:    assert_string_equal(res.body, "{\"faults\":[]}");
call    0 returned 1
        1:  272:}
        -:  273:
function test_route_faults_with_id called 1 returned 100% blocks executed 100%
        1:  274:static void test_route_faults_with_id(void **state) {
        1:  275:    reset_mocks();
call    0 returned 1
        -:  276:    
        -:  277:    HttpRequest req;
        -:  278:    HttpResponse res;
        -:  279:    
        1:  280:    strcpy(req.path, "/api/faults/789");
        1:  281:    strcpy(req.method, "GET");
        -:  282:    
        1:  283:    handle_route(&req, &res);
call    0 returned 1
        -:  284:    
        1:  285:    assert_int_equal(mock_fault_handler_called, 1);
call    0 returned 1
        1:  286:}
        -:  287:
function test_route_alerts called 1 returned 100% blocks executed 100%
        1:  288:static void test_route_alerts(void **state) {
        1:  289:    reset_mocks();
call    0 returned 1
        -:  290:    
        -:  291:    HttpRequest req;
        -:  292:    HttpResponse res;
        -:  293:    
        1:  294:    strcpy(req.path, "/api/alerts");
        1:  295:    strcpy(req.method, "GET");
        -:  296:    
        1:  297:    handle_route(&req, &res);
call    0 returned 1
        -:  298:    
        1:  299:    assert_int_equal(mock_alert_service_called, 1);
call    0 returned 1
        1:  300:    assert_int_equal(mock_machine_handler_called, 0);
call    0 returned 1
        1:  301:    assert_int_equal(res.status_code, 200);
call    0 returned 1
        1:  302:    assert_string_equal(res.content_type, "application/json");
call    0 returned 1
        1:  303:    assert_string_equal(res.body, "{\"alerts\":[{\"id\":1,\"message\":\"test\"}]}");
call    0 returned 1
        1:  304:}
        -:  305:
        -:  306:/* ====================================================================
        -:  307: * Test Cases - 404 Not Found
        -:  308: * ==================================================================== */
        -:  309:
function test_route_not_found called 1 returned 100% blocks executed 100%
        1:  310:static void test_route_not_found(void **state) {
        1:  311:    reset_mocks();
call    0 returned 1
        -:  312:    
        -:  313:    HttpRequest req;
        -:  314:    HttpResponse res;
        -:  315:    
        1:  316:    strcpy(req.path, "/api/unknown");
        1:  317:    strcpy(req.method, "GET");
        -:  318:    
        1:  319:    handle_route(&req, &res);
call    0 returned 1
        -:  320:    
        -:  321:    // Hiçbir handler çağrılmamalı
        1:  322:    assert_int_equal(mock_machine_handler_called, 0);
call    0 returned 1
        1:  323:    assert_int_equal(mock_inventory_handler_called, 0);
call    0 returned 1
        1:  324:    assert_int_equal(mock_auth_handler_called, 0);
call    0 returned 1
        1:  325:    assert_int_equal(mock_maintenance_handler_called, 0);
call    0 returned 1
        1:  326:    assert_int_equal(mock_report_handler_called, 0);
call    0 returned 1
        1:  327:    assert_int_equal(mock_fault_handler_called, 0);
call    0 returned 1
        1:  328:    assert_int_equal(mock_alert_service_called, 0);
call    0 returned 1
        -:  329:    
        -:  330:    // 404 response kontrolü
        1:  331:    assert_int_equal(res.status_code, 404);
call    0 returned 1
        1:  332:    assert_string_equal(res.content_type, "application/json");
call    0 returned 1
        1:  333:    assert_string_equal(res.body, "{\"error\": \"Route not found\"}");
call    0 returned 1
        1:  334:}
        -:  335:
function test_route_empty_path called 1 returned 100% blocks executed 100%
        1:  336:static void test_route_empty_path(void **state) {
        1:  337:    reset_mocks();
call    0 returned 1
        -:  338:    
        -:  339:    HttpRequest req;
        -:  340:    HttpResponse res;
        -:  341:    
        1:  342:    strcpy(req.path, "");
        1:  343:    strcpy(req.method, "GET");
        -:  344:    
        1:  345:    handle_route(&req, &res);
call    0 returned 1
        -:  346:    
        1:  347:    assert_int_equal(res.status_code, 404);
call    0 returned 1
        1:  348:    assert_string_equal(res.body, "{\"error\": \"Route not found\"}");
call    0 returned 1
        1:  349:}
        -:  350:
function test_route_root_path called 1 returned 100% blocks executed 100%
        1:  351:static void test_route_root_path(void **state) {
        1:  352:    reset_mocks();
call    0 returned 1
        -:  353:    
        -:  354:    HttpRequest req;
        -:  355:    HttpResponse res;
        -:  356:    
        1:  357:    strcpy(req.path, "/");
        1:  358:    strcpy(req.method, "GET");
        -:  359:    
        1:  360:    handle_route(&req, &res);
call    0 returned 1
        -:  361:    
        1:  362:    assert_int_equal(res.status_code, 404);
call    0 returned 1
        1:  363:}
        -:  364:
        -:  365:/* ====================================================================
        -:  366: * Test Cases - Farklı HTTP Metodları
        -:  367: * ==================================================================== */
        -:  368:
function test_route_machines_post called 1 returned 100% blocks executed 100%
        1:  369:static void test_route_machines_post(void **state) {
        1:  370:    reset_mocks();
call    0 returned 1
        -:  371:    
        -:  372:    HttpRequest req;
        -:  373:    HttpResponse res;
        -:  374:    
        1:  375:    strcpy(req.path, "/api/machines");
        1:  376:    strcpy(req.method, "POST");
        1:  377:    strcpy(req.body, "{\"name\":\"new machine\"}");
        -:  378:    
        1:  379:    handle_route(&req, &res);
call    0 returned 1
        -:  380:    
        1:  381:    assert_int_equal(mock_machine_handler_called, 1);
call    0 returned 1
        -:  382:    // Handler metod farkına bakmamalı, sadece path'e bakıyor
        1:  383:}
        -:  384:
function test_route_inventory_put called 1 returned 100% blocks executed 100%
        1:  385:static void test_route_inventory_put(void **state) {
        1:  386:    reset_mocks();
call    0 returned 1
        -:  387:    
        -:  388:    HttpRequest req;
        -:  389:    HttpResponse res;
        -:  390:    
        1:  391:    strcpy(req.path, "/api/inventory/1");
        1:  392:    strcpy(req.method, "PUT");
        -:  393:    
        1:  394:    handle_route(&req, &res);
call    0 returned 1
        -:  395:    
        1:  396:    assert_int_equal(mock_inventory_handler_called, 1);
call    0 returned 1
        1:  397:}
        -:  398:
function test_route_faults_delete called 1 returned 100% blocks executed 100%
        1:  399:static void test_route_faults_delete(void **state) {
        1:  400:    reset_mocks();
call    0 returned 1
        -:  401:    
        -:  402:    HttpRequest req;
        -:  403:    HttpResponse res;
        -:  404:    
        1:  405:    strcpy(req.path, "/api/faults/789");
        1:  406:    strcpy(req.method, "DELETE");
        -:  407:    
        1:  408:    handle_route(&req, &res);
call    0 returned 1
        -:  409:    
        1:  410:    assert_int_equal(mock_fault_handler_called, 1);
call    0 returned 1
        1:  411:}
        -:  412:
        -:  413:/* ====================================================================
        -:  414: * Test Cases - Path Çakışmaları
        -:  415: * ==================================================================== */
        -:  416:
function test_route_order_priority called 1 returned 100% blocks executed 100%
        1:  417:static void test_route_order_priority(void **state) {
        1:  418:    reset_mocks();
call    0 returned 1
        -:  419:    
        -:  420:    HttpRequest req;
        -:  421:    HttpResponse res;
        -:  422:    
        -:  423:    // /api/machines önce kontrol ediliyor
        1:  424:    strcpy(req.path, "/api/machines/inventory"); // Bu path hem machines hem inventory ile eşleşebilir
        1:  425:    strcpy(req.method, "GET");
        -:  426:    
        1:  427:    handle_route(&req, &res);
call    0 returned 1
        -:  428:    
        -:  429:    // İlk eşleşen handler çağrılmalı (machines)
        1:  430:    assert_int_equal(mock_machine_handler_called, 1);
call    0 returned 1
        1:  431:    assert_int_equal(mock_inventory_handler_called, 0);
call    0 returned 1
        1:  432:}
        -:  433:
function test_route_similar_paths called 1 returned 100% blocks executed 100%
        1:  434:static void test_route_similar_paths(void **state) {
        1:  435:    reset_mocks();
call    0 returned 1
        -:  436:    
        -:  437:    HttpRequest req;
        -:  438:    HttpResponse res;
        -:  439:    
        1:  440:    strcpy(req.path, "/api/maintenance/reports"); // Hem maintenance hem reports
        1:  441:    strcpy(req.method, "GET");
        -:  442:    
        1:  443:    handle_route(&req, &res);
call    0 returned 1
        -:  444:    
        -:  445:    // İlk eşleşen: maintenance
        1:  446:    assert_int_equal(mock_maintenance_handler_called, 1);
call    0 returned 1
        1:  447:    assert_int_equal(mock_report_handler_called, 0);
call    0 returned 1
        1:  448:}
        -:  449:
        -:  450:/* ====================================================================
        -:  451: * Test Cases - Edge Cases
        -:  452: * ==================================================================== */
        -:  453:
function test_route_null_path called 0 returned 0% blocks executed 0%
    #####:  454:static void test_route_null_path(void **state) {
    #####:  455:    reset_mocks();
call    0 never executed
        -:  456:    
        -:  457:    HttpRequest req;
        -:  458:    HttpResponse res;
        -:  459:    
    #####:  460:    memset(&req, 0, sizeof(req));
        -:  461:    // path null olabilir, strstr NULL pointer ile çağrılır mı?
        -:  462:    // Gerçek kodda path'in null olması beklenmez ama yine de test edelim
        -:  463:    
        -:  464:    // Not: Bu test çökebilir, gerçek kodda path'in hep valid olduğunu varsayıyoruz
        -:  465:    // req.path[0] = '\0'; olarak bırakıyoruz
        -:  466:    
    #####:  467:    handle_route(&req, &res);
call    0 never executed
        -:  468:    
        -:  469:    // Muhtemelen 404 döner
    #####:  470:    assert_int_equal(res.status_code, 404);
call    0 never executed
    #####:  471:}
        -:  472:
function test_route_very_long_path called 1 returned 100% blocks executed 100%
        1:  473:static void test_route_very_long_path(void **state) {
        1:  474:    reset_mocks();
call    0 returned 1
        -:  475:    
        -:  476:    HttpRequest req;
        -:  477:    HttpResponse res;
        -:  478:    
        -:  479:    char long_path[1000];
        1:  480:    strcpy(long_path, "/api/machines/");
        1:  481:    memset(long_path + strlen(long_path), 'a', 900);
        1:  482:    long_path[950] = '\0';
        -:  483:    
        1:  484:    strcpy(req.path, long_path);
        1:  485:    strcpy(req.method, "GET");
        -:  486:    
        1:  487:    handle_route(&req, &res);
call    0 returned 1
        -:  488:    
        -:  489:    // Başlangıç /api/machines ile eşleşmeli
        1:  490:    assert_int_equal(mock_machine_handler_called, 1);
call    0 returned 1
        1:  491:}
        -:  492:
function test_route_path_with_query called 1 returned 100% blocks executed 100%
        1:  493:static void test_route_path_with_query(void **state) {
        1:  494:    reset_mocks();
call    0 returned 1
        -:  495:    
        -:  496:    HttpRequest req;
        -:  497:    HttpResponse res;
        -:  498:    
        1:  499:    strcpy(req.path, "/api/inventory?min=10&max=100");
        1:  500:    strcpy(req.method, "GET");
        1:  501:    strcpy(req.query_params, "min=10&max=100");
        -:  502:    
        1:  503:    handle_route(&req, &res);
call    0 returned 1
        -:  504:    
        1:  505:    assert_int_equal(mock_inventory_handler_called, 1);
call    0 returned 1
        -:  506:    // Query params path'ten ayrılmış olmalı
        1:  507:    assert_string_equal(req.query_params, "min=10&max=100");
call    0 returned 1
        1:  508:}
        -:  509:
        -:  510:/* ====================================================================
        -:  511: * Main test runner
        -:  512: * ==================================================================== */
        -:  513:
function main called 1 returned 100% blocks executed 100%
        1:  514:int main(void) {
        1:  515:    const struct CMUnitTest tests[] = {
        -:  516:        // Ana route'lar
        -:  517:        cmocka_unit_test(test_route_machines),
        -:  518:        cmocka_unit_test(test_route_machines_with_id),
        -:  519:        cmocka_unit_test(test_route_inventory),
        -:  520:        cmocka_unit_test(test_route_inventory_with_sku),
        -:  521:        cmocka_unit_test(test_route_login),
        -:  522:        cmocka_unit_test(test_route_maintenance),
        -:  523:        cmocka_unit_test(test_route_maintenance_with_id),
        -:  524:        cmocka_unit_test(test_route_reports),
        -:  525:        cmocka_unit_test(test_route_reports_with_type),
        -:  526:        cmocka_unit_test(test_route_faults),
        -:  527:        cmocka_unit_test(test_route_faults_with_id),
        -:  528:        cmocka_unit_test(test_route_alerts),
        -:  529:        
        -:  530:        // 404 testleri
        -:  531:        cmocka_unit_test(test_route_not_found),
        -:  532:        cmocka_unit_test(test_route_empty_path),
        -:  533:        cmocka_unit_test(test_route_root_path),
        -:  534:        
        -:  535:        // Farklı HTTP metodları
        -:  536:        cmocka_unit_test(test_route_machines_post),
        -:  537:        cmocka_unit_test(test_route_inventory_put),
        -:  538:        cmocka_unit_test(test_route_faults_delete),
        -:  539:        
        -:  540:        // Path çakışmaları
        -:  541:        cmocka_unit_test(test_route_order_priority),
        -:  542:        cmocka_unit_test(test_route_similar_paths),
        -:  543:        
        -:  544:        // Edge cases
        -:  545:        cmocka_unit_test(test_route_very_long_path),
        -:  546:        cmocka_unit_test(test_route_path_with_query),
        -:  547:        // cmocka_unit_test(test_route_null_path), // Bu test çökebilir, yoruma al
        -:  548:    };
        -:  549:    
        1:  550:    return cmocka_run_group_tests(tests, NULL, NULL);
call    0 returned 1
        -:  551:}
